 @model ReplayFXSchedule.Web.Models.Event

@{
    ViewBag.Title = "Create Event";
}

<div class="card">
    <div class="card-header">
        <h4 class="card-title">Create Event</h4>
    </div>
    <div class="card-body">


       @using (Html.BeginForm("Create", "Events", null, FormMethod.Post, new { enctype = "multipart/form-data" }))
        {
            @Html.AntiForgeryToken()

            @Html.Partial("_EventForm")
        }
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script>
        categories = [@ViewBag.EventTypeIDs];
        $('#categories').val(categories.toString());

        function loadCategories() {
            $.ajax({
                url: '/api/v2/categories/@ViewBag.ConId',
                type: 'GET',
                success: function (data) {
                    $('#EventTypes').html('');
                    data.map(function (category) {
                        $('#EventTypes').append('<li id="cat' + category.Id + '" data-id=' + category.Id + '><span id="catspan' + category.Id + '"></span>' + category.Name + '</li>');
                        $('#cat' + category.Id).click(function () { toggleCategory(category.Id); });
                        if (categories.indexOf(category.Id) > -1)
                        { $('#catspan' + category.Id).addClass('fa fa-check');}
                    });
                    //$('#CatList').append('</ul>');
                }
            })
        }

        function toggleCategory(id) {
            // if it is not there
            // add the hidden input element
            // add the checkmark to the category
            if (!$('#catspan' + id).hasClass('fa fa-check')) {
                categories.push(id);
                $('#categories').val(categories.toString());
                $('#catspan' + id).addClass('fa fa-check');
            }
            else {

                // if it is there
                // remove the hidden input element
                // remove the checkmark on the category
                var i = categories.indexOf(id);
                categories.splice(i, 1);
                $('#categories').val(categories.toString());
                $('#catspan' + id).removeClass('fa fa-check');
            }
        }
        function previewfile() {
            //displays a preview version of the image before it is saved to the database
            var preview = document.querySelector('img');
            var file = document.querySelector('input[type=file]').files[0];
            var reader = new FileReader();
            reader.addEventListener("load", function () {
                preview.src = reader.result;
            }, false);
            if (file) {
                reader.readAsDataURL(file);
            }
        }

        function initialize()
        {
            loadCategories();
            loadFormItems();
        }

        function loadFormItems()
        {
            if ($(".datepicker").length != 0) {
                $('.datepicker').datetimepicker({
                    format: 'MM/DD/YYYY',
                    icons: {
                        time: "now-ui-icons tech_watch-time",
                        date: "now-ui-icons ui-1_calendar-60",
                        up: "fa fa-chevron-up",
                        down: "fa fa-chevron-down",
                        previous: 'now-ui-icons arrows-1_minimal-left',
                        next: 'now-ui-icons arrows-1_minimal-right',
                        today: 'fa fa-screenshot',
                        clear: 'fa fa-trash',
                        close: 'fa fa-remove'
                    }
                });
            }

            if ($(".timepicker").length != 0) {
                $('.timepicker').datetimepicker({
                    format: 'HH:mm A',
                    stepping: 15,
                    icons: {
                        time: "now-ui-icons tech_watch-time",
                        date: "now-ui-icons ui-1_calendar-60",
                        up: "fa fa-chevron-up",
                        down: "fa fa-chevron-down",
                        previous: 'now-ui-icons arrows-1_minimal-left',
                        next: 'now-ui-icons arrows-1_minimal-right',
                        today: 'fa fa-screenshot',
                        clear: 'fa fa-trash',
                        close: 'fa fa-remove'
                    }
                });
            }

            $('.fileinput').fileinput()

        }

        $(initialize);
                
    </script>


}
